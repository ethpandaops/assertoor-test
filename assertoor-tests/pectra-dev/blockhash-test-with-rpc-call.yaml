id: blockhash-test
name: "BLOCKHASH opcode test"
timeout: 1h
config:
  #walletPrivkey: ""
tasks:
- name: check_clients_are_healthy
  title: "Check if at least one client is ready"
  timeout: 5m
  config:
    minClientCount: 1
- name: check_execution_block
  title: "Check head block and block hash from EL RPC"
  timeout: 5m
  config:
    BlockHeaderResultVar: "headBlock"
- name: run_shell
  title: "Convert block number to EIP-2935 input"
  config:
    envVars:
      BLOCK: "headBlock"
    command: |
      echo "::set-var headBlockHash $(echo $BLOCK | jq -r '.hash')"
      BLOCK_NUMBER=$(echo $BLOCK | jq -r '.number')
      hexval=$(printf "0x000000000000000000000000000000000000000000000000%016x\n" $BLOCK_NUMBER)
      echo "::set-var eip2935input $hexval"
- name: check_eth_call
  title: "Check EIP-2935 contract result"
  configVars:
    EthCallData: "eip2935Input"
    ExpectResult: "headBlockHash"